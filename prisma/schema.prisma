

generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int       @id @default(autoincrement())
  fullName      String    @db.VarChar(40)
  email         String    @unique
  password      String    
  phone         String?
  role          UserRole  @default(CUSTOMER)
  status        UserStatus  @default(INACTIVE)
  avatar        String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  //relation
  addresses     Address[]
  cart          Cart?
  orders        Order[]
  wishList      WishList[]
  reviews       Review[]
}

model Address {
  id            Int       @id @default(autoincrement())
  userId        Int
  fullName      String
  phone         String
  city          String
  district      String
  ward          String
  country       String
  isDefault     Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User      @relation(fields: [userId], references: [id])

  orders        Order[]

}

model Product {
  id            Int       @id  @default(autoincrement())
  name          String  
  description   String?
  price         Decimal   @db.Decimal(10,2)
  salePrice     Decimal?  @db.Decimal(10,2)
  stock         Int
  brand         String?
  categoryId    Int
  sku           String    @unique
  weight        Decimal?  @db.Decimal(10,2)
  dimensions    String?
  status        ProductStatus
  featured      Boolean   @default(false)
  viewCount     Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt


  category      Category  @relation(fields: [categoryId], references: [id])
  cartItems     CartItem[]
  orderItems    OrderItem[]
  images        ProductImage[]
  wishList      WishList[]
  reviews       Review[]
}


model ProductImage{
  id            Int        @id  @default(autoincrement())
  productId     Int
  url           String
  altText       String?
  isPrimary     Boolean    @default(false)
  sortOrder     Int        @default(0)
  createdAt     DateTime   @default(now())

  product       Product    @relation(fields: [productId], references: [id])
}


model Cart {
  id            Int       @id @default(autoincrement())
  userId        Int       @unique
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User      @relation(fields: [userId], references: [id])
  items         CartItem[]
}


model CartItem {
  id            Int       @id @default(autoincrement())
  cardId        Int
  productId     Int
  quantity      Int 
  price         Decimal   @db.Decimal(10,2)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  cart          Cart      @relation(fields: [cardId], references: [id])
  product       Product   @relation(fields: [productId], references: [id])
}



model Order {
  id            Int       @id @default(autoincrement())
  orderNumber   String    @unique
  userId        Int
  addressId     Int
  status        OrderStatus
  totalPrice    Decimal   @db.Decimal(10,2)
  paymentMethod PaymentMethod
  paymentStatus PaymentStatus
  shippingFee   Decimal   @db.Decimal(10,2)
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User      @relation(fields: [userId], references: [id])
  address       Address   @relation(fields: [addressId], references: [id])
  items         OrderItem[]
  reviews       Review[]
}


model OrderItem{
  id            Int       @id   @default(autoincrement())
  orderId       Int       
  productId     Int
  quantity      Int
  price         Decimal   @db.Decimal(10,2)
  productName   String
  productImage  String?
  createdAt     DateTime  @default(now())

  order         Order     @relation(fields: [orderId], references: [id])
  product       Product   @relation(fields: [productId], references: [id])
}

model  Category{
  id            Int       @id @default(autoincrement())
  name          String    @unique
  parentId      Int?
  description   String?
  imageUrl      String?
  isActive      Boolean   @default(true)
  sortOrder     Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  parent        Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  children      Category[] @relation("CategoryToCategory")
  product       Product[]
}

model WishList{
  id            Int        @id @default(autoincrement())
  userId        Int 
  productId     Int
  createdAt     DateTime  @default(now())
  
  user          User      @relation(fields: [userId], references: [id])
  product       Product   @relation(fields: [productId], references: [id])
}


model Review {
  id            Int       @id   @default(autoincrement())
  userId        Int
  productId     Int
  orderId       Int
  rating        Int
  comment       String?
  isVertifiedPurchase Boolean @default(false)
  status        ReviewStatus
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  user          User        @relation(fields: [userId], references: [id])
  product       Product     @relation(fields: [productId], references: [id])
  order         Order       @relation(fields: [orderId], references: [id])
}


//
// ENUMS
//
enum UserRole {
  CUSTOMER
  ADMIN
  AGENT
}

enum UserStatus {
  ACTIVE
  INACTIVE
  BANNED
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  COMPLETED
  CANCELLED
}

enum PaymentMethod {
  COD
  CREDIT_CARD
  PAYPAL
  BANK_TRANSFER
}

enum PaymentStatus {
  UNPAID
  PAID
  REFUNDED
}

enum ProductStatus {
  ACTIVE
  INACTIVE
  OUT_OF_STOCK
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
}